
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>PC Remote bypass Input Block</title>
    <script src="socket.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
      }
      body {
        height: 100vh;
        overflow: hidden;
      }
      #screen {
        width: 100%;
        height: 100%;
        border: none;
        position: relative; /* Ensure the image position is relative for mouse coordinates */
      }
    </style>
  </head>
  <body>
    <img id="screen" />
    <audio id="audio" controls style="display: none"></audio>
    <script type="text/javascript">
            const socket = io.connect(
                "http://" + document.domain + ":" + location.port
            );


      // Get the current URL
      const currentUrl = window.location.href;



      let width = 1920;
      let height = 1080;
      socket.on("screen_size",function(data) {
        width = data.width;
        height = data.height;

        // auto reload every 30 minutes
        setTimeout(() => {
          location.reload();
        }, 1800000); // 30 minutes in milliseconds

      });

      socket.on("alert",function(data) {
        blinkHideShow('screen', 20, 200);
      });


      function blinkHideShow(elementId, times = 3, interval = 200) {
        const el = document.getElementById(elementId);
        if (!el) return;
        let count = 0;
        let visible = true;

        const blink = setInterval(() => {
          el.style.display = visible ? 'none' : 'block';
          visible = !visible;
          count++;
          if (count >= times * 2) {
            clearInterval(blink);
            el.style.display = 'block'; // Ensure visible at end
          }
        }, interval);
      }

// Usage: blinkHideShow('screen', 3, 200);
      // Function to scale mouse coordinates based on the server's resolution
      function scaleCoordinates(
        x,
        y,
        serverWidth,
        serverHeight,
        viewerWidth,
        viewerHeight
      ) {
        const scaleX = serverWidth / viewerWidth;
        const scaleY = serverHeight / viewerHeight;

        return {
          x: x * scaleX,
          y: y * scaleY,
        };
      }

      socket.on("connect", function () {
        
      });

      socket.on("screen_share", function (data) {
        var screen = document.getElementById("screen");
        if (data.image) {
          screen.src = "data:image/jpeg;base64," + data.image;
        }
      });


      document
        .getElementById("screen")
        .addEventListener("click", function (event) {
          const rect = this.getBoundingClientRect();
          const viewerWidth = rect.width;
          const viewerHeight = rect.height;
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          const scaledCoords = scaleCoordinates(
            x,
            y,
            width,
            height,
            viewerWidth,
            viewerHeight
          );

          let buttonType = event.button === 0 ? "left" : "right";
          socket.emit("remote_control", {
            type: "mouse_click",
            x: scaledCoords.x,
            y: scaledCoords.y,
            button: buttonType,
          });
        });

      document
        .getElementById("screen")
        .addEventListener("mousemove", function (event) {
          const rect = this.getBoundingClientRect();
          const viewerWidth = rect.width;
          const viewerHeight = rect.height;
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          const scaledCoords = scaleCoordinates(
            x,
            y,
            width,
            height,
            viewerWidth,
            viewerHeight
          );

          socket.emit("remote_control", {
            type: "mouse_move",
            x: scaledCoords.x,
            y: scaledCoords.y,
          });
        });

      document
        .getElementById("screen")
        .addEventListener("contextmenu", function (event) {
          event.preventDefault();
          const rect = this.getBoundingClientRect();
          const viewerWidth = rect.width;
          const viewerHeight = rect.height;
          const x = event.clientX - rect.left;
          const y = event.clientY - rect.top;
          const scaledCoords = scaleCoordinates(
            x,
            y,
            width,
            height,
            viewerWidth,
            viewerHeight
          );

          socket.emit("remote_control", {
            type: "mouse_click",
            x: scaledCoords.x,
            y: scaledCoords.y,
            button: "right",
          });
        });

      document.addEventListener("keypress", function (event) {
        const key = event.key;
        const ctrlKey = event.ctrlKey;
        socket.emit("remote_control", {
          type: "keypress",
          key: key,
          ctrl: ctrlKey,
        });
      });


      document
        .getElementById("screen")
        .addEventListener("touchstart", function (event) {
          event.preventDefault(); // Prevent default touch behavior like scrolling
          const touches = event.touches;
          const rect = this.getBoundingClientRect();
          const viewerWidth = rect.width;
          const viewerHeight = rect.height;
          const x = touches[0].clientX - rect.left;
          const y = touches[0].clientY - rect.top;
          const scaledCoords = scaleCoordinates(
            x,
            y,
            width,
            height,
            viewerWidth,
            viewerHeight
          );

          if (touches.length === 1) {
            // One finger touch - left click
            socket.emit("remote_control", {
              type: "mouse_click",
              x: scaledCoords.x,
              y: scaledCoords.y,
              button: "left",
            });
          } else if (touches.length === 2) {
            // Two finger touch - right click
            socket.emit("remote_control", {
              type: "mouse_click",
              x: scaledCoords.x,
              y: scaledCoords.y,
              button: "right",
            });
          }
        });

      document
        .getElementById("screen")
        .addEventListener("touchmove", function (event) {
          if (event.touches.length === 3) {
            // Three finger touch - check for pinch zoom gesture
            // Implement zoom detection logic here
            console.log("Zoom gesture detected");
          }
        });
    </script>
  </body>
</html>
